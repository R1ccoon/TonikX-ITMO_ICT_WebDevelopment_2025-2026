# Frontend - Vue.js приложение

## Описание

Frontend часть системы Printing House представляет собой современное одностраничное приложение (SPA), построенное на Vue.js 3 с использованием TypeScript и Vuetify для создания пользовательского интерфейса.

## Технологии

- **Vue.js 3.5.25** - прогрессивный JavaScript фреймворк
- **TypeScript 5.9.0** - типизированный JavaScript
- **Vuetify 3.11.2** - Material Design компоненты для Vue
- **Vue Router 4.6.3** - маршрутизация
- **Pinia 3.0.4** - управление состоянием
- **Axios 1.13.2** - HTTP клиент
- **Vite 7.2.4** - сборщик и dev-сервер
- **@mdi/font 7.4.47** - Material Design Icons

## Установка и запуск

### Требования

- Node.js версии 20.19.0 или выше (или 22.12.0+)
- pnpm 10.17.1+

### Установка зависимостей

```bash
cd lab-4
pnpm install
```

### Запуск в режиме разработки

```bash
pnpm dev
```

Приложение будет доступно по адресу: `http://localhost:5173`

### Сборка для production

```bash
pnpm build
```

### Проверка типов

```bash
pnpm type-check
```

### Линтинг

```bash
pnpm lint
```

## Архитектура приложения

### Компоненты

#### Главный компонент (App.vue)

Главный компонент приложения содержит:
- Навигационную панель с меню
- Боковое меню для быстрого доступа к разделам
- Роутер для отображения страниц

#### Страницы (Views)

1. **HomeView** - Главная страница с дашбордом
   - Статистика по всем сущностям
   - Быстрые ссылки на создание
   - Отчет о работе типографий

   ![Главная панель приложения](docs/img/dashboard.png)

2. **LoginView** - Страница входа
   - Форма авторизации
   - Валидация полей
   - Обработка ошибок

3. **RegisterView** - Страница регистрации
   - Форма регистрации с подтверждением пароля
   - Валидация
   - Автоматический вход после регистрации

4. **ProfileView** - Страница профиля
   - Вкладка "Личные данные" - редактирование username и email
   - Вкладка "Смена пароля" - изменение пароля

5. **NewspapersView** - Управление газетами
   - Таблица со списком газет
   - Создание/редактирование/удаление
   - Просмотр деталей с тиражами

6. **PrintingHousesView** - Управление типографиями
   - Таблица со списком типографий
   - Создание/редактирование/удаление
   - Просмотр деталей с тиражами

7. **PostOfficesView** - Управление почтовыми отделениями
   - Таблица со списком почтовых отделений
   - Создание/редактирование/удаление
   - Просмотр деталей с распределениями

8. **DistributionsView** - Управление распределениями
   - Таблица со списком распределений
   - Создание/редактирование/удаление
   - Выбор из существующих газет, типографий и почтовых отделений

### Сервисы

#### API Service (services/api.ts)

Централизованный сервис для работы с API:

- **Аутентификация:**
  - `login()` - вход в систему
  - `register()` - регистрация
  - `getCurrentUser()` - получение данных пользователя
  - `updateUser()` - обновление профиля
  - `changePassword()` - смена пароля

- **Газеты:**
  - `getNewspapers()` - список газет
  - `getNewspaper()` - детали газеты
  - `createNewspaper()` - создание
  - `updateNewspaper()` - обновление
  - `deleteNewspaper()` - удаление
  - `getNewspaperFullDetail()` - детали с вложенными объектами
  - `getNewspapersByName()` - поиск по имени
  - `getNewspaperInfo()` - справка об индексе и цене

- **Типографии:**
  - `getPrintingHouses()` - список типографий
  - `getPrintingHouse()` - детали типографии
  - `createPrintingHouse()` - создание
  - `updatePrintingHouse()` - обновление
  - `deletePrintingHouse()` - удаление
  - `getPrintingHouseFullDetail()` - детали с тиражами
  - `getLargestCirculationEditor()` - редактор с самым большим тиражом
  - `getPrintingHousesReport()` - отчет о работе типографий

- **Почтовые отделения:**
  - `getPostOffices()` - список почтовых отделений
  - `getPostOffice()` - детали почтового отделения
  - `createPostOffice()` - создание
  - `updatePostOffice()` - обновление
  - `deletePostOffice()` - удаление
  - `getPostOfficeFullDetail()` - детали с распределениями
  - `getPostOfficesByPrice()` - поиск по цене
  - `getPostOfficesLowQuantity()` - поиск по количеству

- **Распределения:**
  - `getDistributions()` - список распределений
  - `getDistribution()` - детали распределения
  - `createDistribution()` - создание
  - `updateDistribution()` - обновление
  - `deleteDistribution()` - удаление
  - `getDistributionByNewspaperAndAddress()` - поиск по газете и адресу

**Особенности:**
- Автоматическое добавление токена авторизации к каждому запросу
- Обработка ошибок 401 (неавторизован) с автоматическим редиректом на страницу входа
- Централизованная обработка ошибок

### Управление состоянием (Pinia)

#### Auth Store (stores/auth.ts)

Управление состоянием аутентификации:

- `user` - данные текущего пользователя
- `token` - токен авторизации
- `loading` - состояние загрузки
- `error` - ошибки
- `isAuthenticated` - вычисляемое свойство (computed) для проверки авторизации

**Методы:**
- `init()` - инициализация (проверка токена при загрузке)
- `login()` - вход в систему
- `register()` - регистрация
- `updateProfile()` - обновление профиля
- `changePassword()` - смена пароля
- `logout()` - выход из системы

### Маршрутизация (Vue Router)

#### Защищенные маршруты

Все маршруты, кроме `/login` и `/register`, требуют аутентификации.

**Маршруты:**
- `/` - главная страница (дашборд)
- `/login` - страница входа
- `/register` - страница регистрации
- `/profile` - профиль пользователя
- `/newspapers` - управление газетами
- `/printing-houses` - управление типографиями
- `/post-offices` - управление почтовыми отделениями
- `/distributions` - управление распределениями

**Защита маршрутов:**
- Автоматический редирект на `/login` для неавторизованных пользователей
- Автоматический редирект на главную для авторизованных пользователей, пытающихся зайти на `/login` или `/register`

## Аутентификация

### Процесс входа

1. Пользователь вводит username и password
2. Отправляется запрос на `/auth/token/login/`
3. При успехе токен сохраняется в `localStorage`
4. Загружаются данные пользователя через `/auth/users/me/`
5. Происходит редирект на главную страницу

### Хранение токена

Токен хранится в `localStorage` под ключом `auth_token` и автоматически добавляется к каждому API запросу в заголовке `Authorization: Token <токен>`.

### Обработка истечения токена

При получении ответа 401 (Unauthorized):
1. Токен удаляется из `localStorage`
2. Пользователь перенаправляется на страницу входа
3. Состояние аутентификации сбрасывается

## UI/UX особенности

### Vuetify компоненты

Приложение использует Material Design компоненты из Vuetify:

- **v-data-table** - таблицы с пагинацией и сортировкой
- **v-dialog** - модальные окна для создания/редактирования
- **v-form** - формы с валидацией
- **v-text-field**, **v-select** - поля ввода
- **v-btn** - кнопки
- **v-card** - карточки для отображения информации
- **v-chip** - чипы для статусов
- **v-alert** - уведомления об ошибках и успехе

### Валидация форм

Все формы имеют клиентскую валидацию:
- Обязательные поля
- Проверка типов данных
- Проверка диапазонов значений
- Проверка совпадения паролей

### Обработка ошибок

- Отображение ошибок валидации под полями
- Глобальные уведомления об ошибках API
- Уведомления об успешных операциях

### Пагинация

Все таблицы поддерживают серверную пагинацию:
- По умолчанию 20 элементов на странице
- Навигация по страницам
- Отображение общего количества элементов

## Интеграция с API

### Базовый URL

По умолчанию API находится по адресу: `http://localhost:8000`

### Заголовки запросов

Все запросы к API включают:
- `Content-Type: application/json`
- `Authorization: Token <токен>` (для авторизованных запросов)

### Обработка ответов

- Успешные ответы обрабатываются и отображаются в UI
- Ошибки валидации отображаются под соответствующими полями
- Ошибки сервера отображаются в виде уведомлений

## Примеры использования

### Создание газеты

1. Перейти на страницу "Газеты"
2. Нажать кнопку "Создать газету"
3. Заполнить форму:
   - Название
   - Индекс издания
   - Имя, фамилия, отчество редактора
   - Цена за экземпляр
4. Нажать "Сохранить"
5. Газета появится в таблице

### Просмотр отчета о типографиях

1. Перейти на главную страницу
2. В разделе "Отчеты" нажать "Отчет о работе типографий"
3. Откроется список активных типографий с детальной информацией:
   - Количество газет
   - Тираж каждой газеты
   - Распределение по почтовым отделениям

### Редактирование профиля

1. Нажать на иконку профиля в правом верхнем углу
2. Перейти на вкладку "Личные данные"
3. Изменить username или email
4. Нажать "Сохранить изменения"

### Смена пароля

1. Перейти в профиль
2. Перейти на вкладку "Смена пароля"
3. Ввести текущий пароль
4. Ввести новый пароль и подтверждение
5. Нажать "Изменить пароль"