# Printing House API + Frontend

## Описание проекта

Проект Printing House представляет собой полнофункциональную систему для отслеживания распределения газет по почтовым отделениям с современным веб-интерфейсом. Система включает как серверную часть (REST API), так и клиентскую часть (Vue.js приложение).

## Основные возможности

### Backend
- Управление газетами (создание, редактирование, просмотр)
- Управление типографиями с отслеживанием их статуса (активна/закрыта)
- Управление почтовыми отделениями
- Отслеживание тиражей газет в типографиях
- Отслеживание распределения газет по почтовым отделениям
- Сложные запросы для получения аналитической информации
- RESTful API с использованием Django REST Framework
- Аутентификация через токены с использованием Djoser

### Frontend
- Полнофункциональный веб-интерфейс на Vue.js 3
- Управление всеми сущностями через UI
- Аутентификация и управление профилем
- Дашборд со статистикой
- Отчеты и аналитика
- Material Design интерфейс

## Технологии

### Backend
- Django 4.2.7
- Django REST Framework 3.14.0
- Djoser 2.1.0 (для аутентификации)
- SQLite (база данных)
- Python 3.8+

### Frontend
- Vue.js 3.5.25
- TypeScript 5.9.0
- Vuetify 3.11.2 (Material Design компоненты)
- Vue Router 4.6.3 (маршрутизация)
- Pinia 3.0.4 (управление состоянием)
- Axios 1.13.2 (HTTP клиент)
- Vite 7.2.4 (сборщик)

## Модели данных

### Газета (Newspaper)
- Название газеты
- Индекс издания (уникальный)
- ФИО редактора (имя, фамилия, отчество)
- Цена экземпляра

### Типография (PrintingHouse)
- Название типографии
- Адрес
- Статус активности (активна/закрыта)

### Почтовое отделение (PostOffice)
- Номер почтового отделения (уникальный)
- Адрес

### Тираж (PrintingRun)
- Связь типографии и газеты
- Размер тиража

### Распределение (Distribution)
- Связь почтового отделения, газеты и типографии
- Количество экземпляров

## API Endpoints

### Аутентификация

Все API endpoints требуют аутентификации через токены.

**Регистрация пользователя:**
```
POST /auth/users/
```

**Получение токена:**
```
POST /auth/token/login/
```

**Информация о текущем пользователе:**
```
GET /auth/users/me/
```

### Газеты

- `GET /api/newspapers/` - список всех газет
- `GET /api/newspapers/{id}/` - детали газеты
- `POST /api/newspapers/` - создание газеты
- `PUT /api/newspapers/{id}/` - обновление газеты
- `DELETE /api/newspapers/{id}/` - удаление газеты
- `GET /api/newspapers/{id}/full_detail/` - газета с вложенными объектами (many-to-many)
- `GET /api/newspapers/by_name/?name=...` - адреса типографий для газеты
- `GET /api/newspapers/info/?id=...` - справка об индексе и цене

### Типографии

- `GET /api/printing-houses/` - список всех типографий
- `GET /api/printing-houses/{id}/` - детали типографии
- `POST /api/printing-houses/` - создание типографии
- `PUT /api/printing-houses/{id}/` - обновление типографии
- `DELETE /api/printing-houses/{id}/` - удаление типографии
- `GET /api/printing-houses/{id}/full_detail/` - типография с вложенными тиражами (one-to-many)
- `GET /api/printing-houses/{id}/largest_circulation_editor/` - редактор газеты с самым большим тиражом
- `GET /api/printing-houses/report/` - отчет о работе типографий

### Почтовые отделения

- `GET /api/post-offices/` - список всех почтовых отделений
- `GET /api/post-offices/{id}/` - детали почтового отделения
- `POST /api/post-offices/` - создание почтового отделения
- `PUT /api/post-offices/{id}/` - обновление почтового отделения
- `DELETE /api/post-offices/{id}/` - удаление почтового отделения
- `GET /api/post-offices/{id}/full_detail/` - почтовое отделение с вложенными распределениями (one-to-many)
- `GET /api/post-offices/by_price/?min_price=...` - почтовые отделения для газет дороже указанной цены
- `GET /api/post-offices/low_quantity/?max_quantity=...` - газеты с количеством меньше заданного

### Распределения

- `GET /api/distributions/` - список всех распределений
- `GET /api/distributions/{id}/` - детали распределения
- `POST /api/distributions/` - создание распределения
- `PUT /api/distributions/{id}/` - обновление распределения
- `DELETE /api/distributions/{id}/` - удаление распределения
- `GET /api/distributions/by_newspaper_and_address/?newspaper_id=...&address=...` - куда поступает газета по адресу

## Frontend приложение

### Архитектура

Frontend представляет собой одностраничное приложение (SPA), построенное на Vue.js 3 с использованием TypeScript и Vuetify.

### Основные страницы

1. **HomeView** - Главная страница с дашбордом
   - Статистика по всем сущностям
   - Быстрые ссылки на создание
   - Отчет о работе типографий

2. **LoginView** - Страница входа
   - Форма авторизации
   - Валидация полей
   - Обработка ошибок

3. **RegisterView** - Страница регистрации
   - Форма регистрации с подтверждением пароля
   - Валидация
   - Автоматический вход после регистрации

4. **ProfileView** - Страница профиля
   - Вкладка "Личные данные" - редактирование username и email
   - Вкладка "Смена пароля" - изменение пароля

5. **NewspapersView** - Управление газетами
   - Таблица со списком газет
   - Создание/редактирование/удаление
   - Просмотр деталей с тиражами

6. **PrintingHousesView** - Управление типографиями
   - Таблица со списком типографий
   - Создание/редактирование/удаление
   - Просмотр деталей с тиражами

7. **PostOfficesView** - Управление почтовыми отделениями
   - Таблица со списком почтовых отделений
   - Создание/редактирование/удаление
   - Просмотр деталей с распределениями

8. **DistributionsView** - Управление распределениями
   - Таблица со списком распределений
   - Создание/редактирование/удаление
   - Выбор из существующих газет, типографий и почтовых отделений

### Управление состоянием

Приложение использует Pinia для управления состоянием:
- **Auth Store** - управление аутентификацией
- Хранение токена в localStorage
- Автоматическое добавление токена к запросам
- Обработка истечения токена

### Маршрутизация

Все маршруты, кроме `/login` и `/register`, требуют аутентификации. Автоматический редирект на страницу входа для неавторизованных пользователей.

## Установка и запуск

### Backend

#### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

#### 2. Применение миграций

```bash
cd printing_house
python manage.py migrate
```

#### 3. Создание тестовых данных

```bash
python create_newspaper_data.py
```

#### 4. Запуск сервера

```bash
python manage.py runserver
```

API будет доступно по адресу: `http://localhost:8000/api/`

### Frontend

#### 1. Установка зависимостей

```bash
cd frontend
pnpm install
```

#### 2. Запуск в режиме разработки

```bash
pnpm dev
```

Приложение будет доступно по адресу: `http://localhost:5173`

#### 3. Сборка для production

```bash
pnpm build
```

## Примеры использования

### Создание газеты через Frontend

1. Перейти на страницу "Газеты"
2. Нажать кнопку "Создать газету"
3. Заполнить форму
4. Нажать "Сохранить"

### Просмотр отчета о типографиях

1. Перейти на главную страницу
2. В разделе "Отчеты" нажать "Отчет о работе типографий"
3. Откроется список активных типографий с детальной информацией

### Использование API напрямую

#### Получение токена

```bash
curl -X POST http://localhost:8000/auth/token/login/ \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "password123"}'
```

#### Использование токена в запросах

```bash
curl -X GET http://localhost:8000/api/newspapers/ \
  -H "Authorization: Token <ваш_токен>"
```

## Дополнительные материалы

- [Frontend документация](../printing_house/frontend.md) - подробное описание Vue.js приложения
- [API Endpoints](endpoints.md) - детальное описание всех endpoints
- [Примеры запросов](examples.md) - примеры использования API

